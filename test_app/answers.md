

## require_once()は何のために記述しているか説明してください。
 - ファイルを一度だけインポートするために書かれています。

## connectPdo() の返り値は何か、またこの記述は何をするための記述か説明してください。
 - connectPdo()の戻り値はPDOのインスタンスまたはnullです。
 - DSN, DB_USER, DB_PASSWORDを使いPDOインスタンスを生成し、戻り値として返す。PDOExceptionが起こった場合はエラーメッセージが表示されexitされる。

## try catchとは何か説明してください。
 - 例外処理をするための構文。try ブロック内で起こったExceptionをcatchでキャッチ例外処理を走らせる。

## PDOクラスをインスタンス化する際にtry catchが必要な理由を説明してください。
 - PDO がインスタンスを生成する際にデータベースとの接続に失敗した場合、PDOExceptionが起こるからです。


# 復習問題

## データの受け取り・受け渡しの処理を記述するのはどのファイルでしたか？
① functions.php     ② connection.php     ③ config.php     ④ store.php

 - ①

## DB操作処理を記述するのはどのファイルでしたか？
① functions.php     ② connection.php     ③ config.php     ④ store.php

 - ②

## アプリケーションの設定を記述するのはどのファイルでしたか？
① functions.php     ② connection.php     ③ config.php     ④ store.php

 - ③

## 以下のフォームの送信ボタンを押下した際にstore.phpの$_POSTにどんな値が格納されますか？
 - keyがname, valueがcontentの連想配列が格納されてる。

## header('location: ./index.html')は何をしているか説明してください。
 - ./index.htmlへリダイレクトする処理。



connection.phpで定義した変数$dbhの中には何を格納したでしょうか？
① PDO文字列     ② PDOクラス     ③ PDO配列     ④ PDOインスタンス

 - ④

## <?= $var; ?>は以下の選択肢のうち、どの処理の省略形ですか？
① <php>$var</php>     ② <?php echo $var; ?>     ③ <?php var_dump($var) ?>     ④ <?php $var; ?>

 - ②

## 一覧ページにTODOを表示するために今回行ったこととして間違っている選択肢はどれですか？
① 一覧取得の関数が使えるように、index.phpでrequire_onceを使ってfunctions.phpを読み込んだ。
② indexページでPHPが使えるようにファイルの拡張子を変更した。
③ SELECT文でDBからデータを取得した。
④ echoはPHPとHTMLが混在しているときは使えないので短縮表現を使った。

 - ④

## queryメソッドの返り値のデータ型は以下の選択肢のうちどれでしょうか？
① PDOインスタンス     ② 連想配列     ③ PDOStatementインスタンス     ④ 文字列

 - ③

## getTodoList()の返り値について説明してください。
 - getTodoList()はgetAllRecords()をreturnしているので、getAllRecords()の戻り値であるtodoが入った配列を返しています。



# PHP APP Update Page

## parse_url関数の返り値のデータ型は以下の選択肢のうちどれでしょうか？
① 連想配列     ② 文字列     ③ Urlオブジェクト     ④ PDOインスタンス
 - ①

## 遷移先にGETでデータを送るときにURLに付与する?以下をなんと言いますか？
① クエリビルダ     ② クエリパラメータ     ③ クエリアンカー     ④ クエリゲット
 - ②

## $_GETや$_SERVERのように、$_で始まる特殊な変数のことをなんと呼びますか？
① インスタンス変数     ② ハイパーテキスト変数     ③ スーパーグローバル変数     ④ スタンダードPHP変数
 - ③

## 以下のaタグのリンクを押下した際にedit.phpの$_GETにどんな値が格納されるか説明してください。

```<a href="edit.php?todo_id=123&todo_content=焼肉">更新</a>```

 - todo_id => 123, todo_content => "焼肉" の連想配列が格納されます。

## savePostedData($post)は何をしているか説明してください。
 - $_POSTされたデータを受け取り、getRefererPath()から返されたパスを元に条件分岐し、connection層(DB層)へpostされたデータを渡しています。

## getRefererPath()は何をしているか説明してください。
-  スーパーグローバル変数である $_SERVER の key 'HTTP_REFERER' の valueを parse_urlに引数として渡します。parse_urlからreturnされた「URLの様々な構成要素のうち特定できるものが入った連想配列」のkeyが'path' の value を return しています。


# PHP App Delete

## 論理削除と物理削除についての説明として正しいものを選択してください
① 物理削除はレコードを完全に消してしまうが、論理削除は復元可能なので、論理削除の方が優れている
② 論理削除と物理削除はそれぞれメリットデメリットがあるため、用途によって使い分けると良い
③ 論理削除はデータを少し変更するだけなので、物理削除よりもパフォーマンスに優れている
④ 物理削除はよほどの理由がない限り使ってはいけない

 - ②

## deleted_atを現在時刻で更新すると一覧画面からToDoが非表示になる理由を説明してください。
 - todoをselect文で取得取得する際にWHEREを使い deleted_at is NULL で取得しているので論理削除が実現されています。

## 今回のように実際のデータを削除せずに非表示にすることで削除されたように扱うことを〇〇削除という。○○に入る言葉は何か
 - 論理

## 反対に実際にデータを削除することを〇〇削除というか。
 - 物理削除

## 前問のそれぞれの削除方法のメリット・デメリットについて説明してください。
論理削除のメリットはいつ何が削除されたのかを後から確認することができることです。
論理削除のデメリットはレコードが増え続けることで、それに合わせてテーブルを設計しないといけない点です。

物理削除のメリットはsqlのwhereの検索が少し軽くなる点です。deleted_at IS NULL がなくなるので少し取得が早くなるかもしれません。
物理削除のデメリットは削除されたらそれ以降そのレコードを確認できないことです。　



# XSS

## XSSとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
 - Formなどからサイトなどにスクリプトを埋め込み、閲覧したユーザーにスクリプトを実行させる攻撃です。
 - 攻撃者はユーザーの情報(Cookie、)などを取得できるメリットがあります。

## htmlspecialchars()をe()として定義しなおすメリットを説明してください。
 - htmlspecialcharsの第２、第３引数が固定なので`e()`を定義することによって省略した書き方でhtmlspecialcharsを使うことができるようになります。
 - コードが読みやすくなるメリットがあります。`<?php echo htmlspecialchars($todo['id'], ENT_QUOTES, 'UTF-8'); ?>` だとコードが一番伝えたいことは `$todo['id']` を表示することですが、htmlspecialcharsの存在感が強すぎてコードが見づらくなってます。`<?php echo e($todo['id']); ?>` と直すことによって`$todo['id']`をエスケープ処理し表示させることがコードを読む側に伝わりやすくなります。

## htmlspecialchars()を使うことでなぜXSSが防げるのか説明してください。
 - `htmlspecialchars()`は特定の文字をHTMLエンティティに変換するPHPの関数なのでXSSを防ぐことをできます。
 - `htmlspecialchars()` に `<script>console.log()<script>` を渡すと `&lt;script&gt;console.log()&lt;/script&gt;` に変換しブラウザはこの文字列を単なるテキストとして表示しますので、スクリプトは実行されません。


# CSRF
## CSRFとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
 - 不特定多数の人に対して意図しないリクエスト送信をさせる攻撃です。攻撃者は不特定多数の人に任意のリクエスト送信させるメリットがあります。

## SessionとCookieの違いを説明してください。
 - Cookieはブラウザで管理されますが、Sessionはサーバー側で管理しています。

## setToken()は何をしているか説明してください。
 - スーパーグローバル変数である`_SESSION`のキー'token'にbin2hexから返されたopenssl_random_pseudo_bytesを引数で使ったtokenを格納しています。

## checkToken()は何をしているか説明してください。
 - empty 関数を使い$_SESSION['token']が存在するかまたは$_SESSION['token']がインプットから受け取った$tokenと一致しているかを確認し、一致していなかったらまたは$_SESSION['token']が存在しない場合、$_SESSION['err']にエラー文を格納しリクエスト元へリダイレクトしています。

## トークンを使うことでなぜCSRFが防げるのか説明してください。
 - サーバーが生成したCSRFトークンと一緒にリクエストを送らないといけない設計にすることによって外部のサイトから意図しないリクエストが送られるのを防いでくれます。



# SQLインジェクション

## SQLインジェクションとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
 - アプリケーションの脆弱性を利用し、任意のSQL文を実行させる攻撃です。攻撃者は任意のSQLを実行するのでデータを消したり、アプリケーションが想定してないことができるメリットがあります。

## ->prepare()の返り値と、またこのメソッドが何をしているか説明してください。
 - `prepare()` の戻り値は `PDOStatement` または `false` です。
 - `PDOStatement::execute()` メソッドによって実行される SQL ステートメントを準備します。ステートメントのテンプレートは、SQL文が実行されるときに実際の値に置き換えられる 0 個もしくはそれ以上のパラメータマークを含むことができます。

## ->bindValue()が何をしているか説明してください。
 - SQL 文の中で、対応する名前あるいは疑問符のプレースホルダに値をバインドします。

## 今回の対策でなぜSQLインジェクションが防げるのか説明してください。
 - プレースホルダを使ってバインドすると、クエリとして解釈されないのでSQLインジェクションを防ぐことができます。


# バリデーション

## バリデーションの目的について説明してください。
 - アプリケーションが求めていない入力を防ぐこと。

## validate()が何をしているか説明してください。
 - postされたデータを引数で受け取ります。issetを使いcontentが宣言されたいないこと、そして null とは異なるかつcontentが🈳であるかを検証して、もしtrueならスーパーグローバル変数の$_SESSIONのキーが'err'のvalueを'入力がありません'に設定し、redirectToPostedPageを使いリクエストがあったもとへリダイレクトされます。

## isset($post['content'])はなぜ必要か、無い場合どうなるか説明してください。
 - `if ($post['content'] === '') {}` だけでバリデーションを書くと、key が 'content' の value が null の時、それを検知できないので、isset($post['content'])を使いnullチェックをします。

## unsetError()を実行しない場合どうなるか説明してください。
 - new.php の `unsetError();` を実行しなかった場合、一度バリデーションエラーに引っかかった後に入力に成功してもindex.phpへ遷移された後もエラーメッセージが表示されます。


